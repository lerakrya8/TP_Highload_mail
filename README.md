# TP_Highload_mail
В данном проекте будет рассмотрен почтовый сервис, с помощью которого можно читать и отправлять письма (с вложениями и без) 

## Тема и целевая аудитория
Почта Mail.ru входит в пятерку самых посещаемых почтовых сервисов по численности пользователей за день, при этом ежемесячная аудитория в РФ составляет [34,5 млн. человек, ежедневная - 20 млн в день](https://journal.tinkoff.ru/news/review-mail-ru-group/).

## MVP
1. Регистрация и авторизация
2. Просмотр почтового ящика
3. Чтение писем
4. Отправка писем
5. Удаление письма

## Расчет нагрузки
#### Продуктовые метрики
* Месячная аудитория - 34.5 млн человек
* Дневная нагрузка - 20 млн человек
* Количество активных акквунтов - [100 млн человек](https://corp.mail.ru/ru/company/portal/) (~68% населения РФ)
* Средний размер хранилища пользователя:

 1. Чтение писем. Предположим, что пользователь читает 12 писем за день. [Около 50% всех писем](https://corp.mail.ru/ru/press/releases/10147/) содержат вложения, из которых 80% это фотографии, 19% - документы и 1 % - видеофайлы и архивы. При этом, каждое пятое письмо содержит два и более вложений. Получается, что в среднем пользователь прочитывает 6 писем без вложений (размер такого письма 4 кб), 2 письма - с двумя и более вложениями (~800 кб) и 4 письма с одним вложением (~400кб)

| Письма без сложений | Письма с вложением| Письма с вложениями |Итого|  
| ------------- |:------------------:| -----:| -----:|
|       24кб   | 1600кб    | 1600кб |3,223 мб|

2. Просмотр почтового ящика. За один визит пользователь просматривает [~6 страниц](https://www.similarweb.com/website/mail.ru/#overview) почтового ящика (50 писем на каждой странице). Размер одного письма в данном случае - 9.3 кб, получается 

```
  6 страниц * 50 писем * 9.3 кб = 2,79 мб
```
3. Отправка писем. В среднем пользователь пишет 5 писем в день. Исходя из данных п.1, получаем

| Письма без сложений | Письма с вложением| Письма с вложениями |Итого|  
| ------------- |:------------------:| -----:| -----:|
|      8 кб   | 800кб    | 800кб |1,608 мб|

Итого, 

| Чтение писем | Проверка почтового ящика| Написание писем |Итого|  
| ------------- |:------------------:| -----:| -----:|
|       3,223 мб   | 2,79 мб  | 1,608 мб | 7,621 мб|

#### Среднее количество действий пользователя по типам в день
За август 2021 года почту mail.ru посетило 2.09 млрд человека со средним временем сессии - 8 минут. За это время пользователь просматривает ~8 страниц.
##### Авторизация
Пользователь заходит на почту [15 раз за день](https://hbr.org/2019/01/how-to-spend-way-less-time-on-email-every-day), следовательно, понадобиться 15 запросов, чтобы проверить авторизован ли он или нет
##### Просмотр почтового ящика
Так же, учитывая данные выше, понадобится 15 запросов на получение последних писем.
##### Чтение писем
За сутки в среднем пользователь прочитает около 12 писем, соответсвенно 12 запросов, чтобы открыть и прочитать каждое письмо
##### Отправка писем
Пользователь пишет около 5 сообщений в день, следовательно, 5 запросов на отпрвку письма
##### Удаление писем
[По статистике за год каждый пользователь получает 11680 писем в год](https://blog.mail.ru/email-forever/), в день получается - 32 письма. [50% из них - спам](https://securelist.ru/spam-and-phishing-in-2020/100408/). Получается, что из 32 писем - 16 писем удаляются. Соотвественно нужно 16 запросов на удаление писем.
| Авторизация | Просмотр почтового ящика| Чтение писем |Отправка писем| Удаление писем |Итого|
| ------------- |:------------------:| -----:| -----:| -----:| -----:|
|     15   | 15    | 12 |5| 16 |63|

### Технические метрики
#### Размер хранения в разбивке по типам данных (в Тб) - для существенных блоков данных.
Существенные блоки - получение почтового ящика, чтение писем, написание писем

```
  Получение почтового ящика = (возьмем месячную нагрузка за действующую) 34,5 * 10^6 * 3,223 мб / 1024 / 1024 = 106 Тб
```
```
  Чтение писем = (возьмем месячную нагрузка за действующую) 34,5 * 10^6 * 2,79 мб / 1024 / 1024 = 91,8 Тб
```
```
  Написание писем = (возьмем месячную нагрузка за действующую) 34,5 * 10^6 * 1,608 мб / 1024 / 1024 = 52,9 Тб
```
#### Сетевой трафик
